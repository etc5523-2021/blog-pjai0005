---
title: "Peru"
description: |
  COVID-19 crisis in Peru.
date: "`r Sys.Date()`"
output:
  distill::distill_article:
    self_contained: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

```

```{r libraries}
# remotes::install_github('htmlwidgets/sparkline')

library(readr)
library(tidyverse)
library(ggplot2)
library(plotly)
library(lubridate)
library(sparkline)
library(DT)
library(formattable)
library(scales)
library(quantmod)

data <- readr::read_csv('https://raw.githubusercontent.com/owid/covid-19-data/master/public/data/owid-covid-data.csv') %>% 
               filter(location == "Peru")
```

```{r}
peru <- data %>% select(location, date, new_cases, positive_rate, new_deaths, new_tests,
                        new_vaccinations, people_vaccinated, people_fully_vaccinated) %>%
  mutate(date = ymd(date),
         day = day(date),
         month = month(date),
         year = year(date))
```

![ ](pics/peru.png)
<p style = "font-family: verdana;font-size: 8pt;"> source: pinterest.com </p>



<style>
body {
  background-color: off white;
}

h2 {
  color: Dark Grey;
  padding: 16px;
}

h3 {
  color: grey;
  padding: 10px;
}


p {
  font-family: Arial;
  font-size: 11pt;
}

</style>



<h2 > Introduction </h2> 

<p>    
  intro
</p>


<h3> Data Description </h3> 

<p>    
  description
</p>



<h3> Data Story </h3>

<p>    
  story
</p> 


<h2> Economic-Pandemic </h2>
```{r}
tab1 <-  peru %>%
  mutate(quaters = quarter(date, with_year = TRUE)) %>% 
  group_by(quaters) %>%
  summarise("Tests" = sum(new_tests, na.rm = TRUE),
            "Positive Cases" = sum(new_cases, na.rm = TRUE),
            "Deaths" = sum(new_deaths, na.rm = TRUE)) %>%
  pivot_longer(cols = -quaters,
               names_to = "Variables",
               values_to = "value")%>%
  pivot_wider(names_from = Variables,
              values_from = value) %>%
  rename(Quaters = quaters)


tab1 %>% 
  select(Quaters, Tests, 'Positive Cases', Deaths) %>% 
  as.data.frame() %>%  
  formattable(list(area(col = 4) ~ color_tile( "#3CB371", "#CD5C5C"))) #Higher value and Lower value

```
<p>
  explain 1st table
</p>


<h2> Vaccination Rate </h2>

```{r}

tab2 <- peru %>%
  group_by(month) %>% filter(year == 2021) %>%
  mutate(month = month(date, label = TRUE)) %>%
  summarise("Vaccination" = sum(new_vaccinations, na.rm = TRUE),
            "Timeline" = spk_chr(new_vaccinations, type ="line"),
            "Partially Vaccinated" = sum(people_vaccinated, na.rm = TRUE),
            "Fully Vaccinated" = sum(people_fully_vaccinated, na.rm = TRUE),
            "Distribution" = spk_chr(people_fully_vaccinated, type ="box"))%>%
  rename(Month = month)


tab2 %>% datatable(escape = FALSE, 
                  caption = htmltools::tags$caption( style = 'caption-side: top; 
                                                              text-align: center;  
                                                              color: black; 
                                                              font-size: 120% ;',
                                                              'Vaccination Rate 2021'),
                  options = c (list(pageLength = 10 ))) %>%
  spk_add_deps()


```

<p>
  explain 2nd table
</p>



<h2> Conclusion </h2>

```{r}
plot<- peru %>%
  mutate(quaters = quarter(date, with_year = TRUE)) %>% 
  group_by(quaters) %>%
  summarise("Tests" = sum(new_tests, na.rm = TRUE),
            "Cases" = sum(new_cases, na.rm = TRUE),
            "Deaths" = sum(new_deaths, na.rm = TRUE),
            "Vaccination" = sum(new_vaccinations, na.rm = TRUE)) %>%
  pivot_longer(cols = -quaters,
               names_to = "Variables",
               values_to = "value")

  ggplot(plot, aes(quaters, value, colour= Variables))+
  geom_line(size = 1.2)+ 
  scale_x_continuous(breaks = seq(2020.1, 2021.3, by= .01))+
  xlim(2020.1, 2021.4)+ 
  labs(x= "20-Q1 to 21-Q3",y= "Value", 
       title = "Timeline of coronavirus impact on Peru")+
  geom_text(aes(x = 2021.19, y = 10.5e+06, label = "Vaccination", color = "Vaccination"))+
  geom_text(aes(x = 2021.34, y = 0.7e+06, label = "Tests", color = "Tests"))+
  geom_text(aes(x = 2021.36, y = 0.1e+06, label = "Cases", color = "Cases"))+
  geom_text(aes(x = 2021.35, y = -0.4e+06, label = "Deaths", color = "Deaths"))+
  theme(legend.position = "none")


```
<p>
  conclusion over here
</p>


