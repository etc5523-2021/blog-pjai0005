---
title: "Peru"
description: |
  COVID-19 crisis in Peru.
output:
  distill::distill_article:
    self_contained: false
---

<br><p style = "font-family: verdana;font-size: 8pt;"> Published on: 2021-09-03 </p>
<br><p style = "font-family: verdana;font-size: 8pt;"> Updated on: `r Sys.Date()` </p>
  
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

```

```{r libraries}
# remotes::install_github('htmlwidgets/sparkline')

library(distill)
library(readr)
library(tidyverse)
library(kableExtra)
library(ggplot2)
library(plotly)
library(lubridate)
library(sparkline)
library(DT)
library(formattable)
library(scales)
library(quantmod)

data <- readr::read_csv('https://raw.githubusercontent.com/owid/covid-19-data/master/public/data/owid-covid-data.csv') %>% 
               filter(location == "Peru")
```

```{r}
peru <- data %>% select(location, date, new_cases, new_deaths, new_tests, new_vaccinations) %>%
  mutate(date = ymd(date),
         day = day(date),
         month = month(date),
         year = year(date))
```


```{r, echo = F, out.width = '50%', fig.align='center'}
knitr::include_graphics("pics/peru.png")
```



<p style = "font-family: verdana;font-size: 8pt; text-align: center;"> 
source: <a href="https://br.pinterest.com/pin/683280574707709186/"> pinterest.com </a> </p>


<h2 > Introduction </h2> 

<p>    
Peru is one of the worst-hit countries in the world by coronavirus. It ranks in the top 5 most severely affected countries in Latin America. According to [BBC June’21](https://www.bbc.com/news/world-latin-america-53150808), Peru estimated approximately 600 coronavirus deaths per 1M people, which is even higher than Brazil, UK, and the US. 
</p>



<h3> Data Story </h3>

<p>    
The avalanching situation in the country abducted many lives and lead to several lockdowns. Peru’s government imposed a lockdown just after 10 days of the country’s first case, hoping that the pain would soon come to an end. We all know this is not the case. So let us see how Peru has dealt with such a humongous plight due to the pandemic.
</p> 


<h3> Data Structure </h>
<p>
```{r}

data_structure <- tibble(Variables = c("location",
                                       "date",
                                       "new_cases",
                                       "new_deaths",
                                       "new_tests",
                                       "new_vaccinations",
                                       "day",
                                       "month",
                                       "year"),
                         
                         Class = c("character",
                                   "date",
                                   "double",
                                   "double",
                                   "double",
                                   "double",
                                   "integer",
                                   "double",
                                   "double"),
       
       
                         Description = c("country name",
                                         "date from Jan-2020",
                                         "covid cases per day",
                                         "covid deaths per day",
                                         "covid tests per day",
                                         "vaccinations per day",
                                         "day extracted from given date",
                                         "month extracted from given date",
                                         "year extracted from given date"))

 datatable(head(data_structure), class = 'cell-border stripe')
   
```

</p>


<h3> Data Description </h3> 

<p>    

The data used in this article is acquired from [Our World in Data](https://ourworldindata.org/coronavirus/country/peru). The data consisted of basic information on coronavirus cases, deaths, vaccinations, and other important aspects for all the countries in the world. It was then filtered with the location and some important columns for a better analysis. 

Some parts of the analysis use terms like quarters for time periods which are usually used for the financial breakdown of a year. A year has 4 quarters: 

<ul>
  <li>Q1: Jan- Mar</li>
  <li>Q2: Apr-Jun</li>
  <li>Q3: Jul- Sep</li>
  <li>Q4: Oct-Dec</li>
</ul>

</p>




<h2> The Pandemic </h2>

<p>
COVID-19 has contributed an enormous amount of disruption to the global financial status. It has ruptured countries with the most stable economies to countries with developing economies like Peru. The below table breakdowns the country’s financial situation over the quarters. 
</p>
```{r}
 peru %>%
  mutate(quaters = quarter(date, with_year = TRUE)) %>% 
  group_by(quaters) %>%
  summarise("Tests" = sum(new_tests, na.rm = TRUE),
            "Cases" = sum(new_cases, na.rm = TRUE),
            "Deaths" = sum(new_deaths, na.rm = TRUE)) %>%
  pivot_longer(cols = -quaters,
               names_to = "Variables",
               values_to = "value")%>%
  pivot_wider(names_from = quaters,
              values_from = value)  %>%
    mutate_each(funs(prettyNum(., big.mark=",")))%>%
     formattable(list(area(col = 6) ~ color_tile("#CD5C5C", "#3CB371")))

   
```
<p>
From the above table, we can see Peru had an alarming rate of positive cases and deaths for the first three months of 2021. Though the positive cases were similar to that of 2020.3, the deaths with more than 50 thousand in the number set the highest record. Surprisingly, the fourth quarter which generally comprises holidays and gatherings has the second least number of cases and deaths.
</p>


<h2> Vaccinations in Peru </h2>

<p>
The vaccinations in Peru started during the first week of February in 2021. The below table shows the vaccination drive pulled by Peru each month.
</p>
```{r}

tab1 <- peru %>%
  group_by(month) %>% filter(year == 2021) %>%
  mutate(month = month(date, label = TRUE)) %>%
  summarise("Vaccination" = sum(new_vaccinations, na.rm = TRUE),
            "Timeline" = spk_chr(new_vaccinations, type ="line"),,
            "Distribution" = spk_chr(new_vaccinations, type ="box"))%>%
  rename(Month = month)


tab1 %>% datatable(escape = FALSE, 
                  caption = htmltools::tags$caption (style = 'caption-side: top; text-align: center;  
                                                              color: black; font-family: Arial; 
                                                              font-size: 150% ;', 'Vaccination 2021')) %>%
  spk_add_deps()%>%
  formatRound('Vaccination', digits = 0)


```

<p>
From the table above, we can see the people hesitated initially to take the vaccination. There are four peaks in the timeline suggesting that people preferred to take vaccinations during the weekends. From the boxplot, we can see that there was a sudden fall in the vaccination number. The data for September is still to be recorded.
</p>



<h2> Conclusion </h2>

```{r}
plot1 <- peru %>% 
  group_by(year, month) %>% filter(year == 2020) %>%
  summarise("Tests" = sum(new_tests, na.rm = TRUE),
            "Cases" = sum(new_cases, na.rm = TRUE),
            "Deaths" = sum(new_deaths, na.rm = TRUE)) %>%
  pivot_longer(cols = c(-year, -month),
               names_to = "Variables",
               values_to = "value")  %>%
  
  ggplot(aes(month, (value/1000000), colour= Variables))+
  geom_line(size = 0.9)+
  scale_x_continuous(breaks = seq(1, 12, by = 1))+
  scale_y_continuous(breaks = seq(0, 3, by = 0.1))+
  labs(x= "Months ",y= "Value in Millions", 
       title = "Before Vaccination")+
  scale_colour_manual(name = "Variables", values = c("blue", "orange", "red"),
                      breaks = c("Tests", "Cases", "Deaths"),
                      labels = c("Tests", "Cases", "Deaths"))+ 
  theme(legend.key = element_rect(fill = "white", colour = "black"),
        legend.text = element_text( c("Tests", "Cases", "Deaths")))
  

plot2 <- peru %>% 
  group_by(year, month) %>% filter(year == 2021) %>%
  summarise("Tests" = sum(new_tests, na.rm = TRUE),
            "Cases" = sum(new_cases, na.rm = TRUE),
            "Deaths" = sum(new_deaths, na.rm = TRUE),
            "Vaccination" = sum(new_vaccinations, na.rm = TRUE)) %>%
  pivot_longer(cols = c(-year, -month),
               names_to = "Variables",
               values_to = "value")  %>%
  
  ggplot(aes(month, (value/1000000), colour= Variables))+
  geom_line(size = 0.9)+
    xlim(1, 8)+
  scale_x_continuous(breaks = seq(1, 8, by = 1))+
  scale_y_continuous(breaks = seq(0, 6, by = 1))+
  labs(x= "Months ",y= "Value in Millions", 
       title = "After Vaccination")+
  scale_colour_manual(name = "Variables", values = c("dark green", "blue", "orange", "red"),
                      breaks = c("Vaccination", "Tests", "Cases", "Deaths"),
                      labels = c("Vaccination", "Tests", "Cases", "Deaths"))+ 
  theme(legend.key = element_rect(fill = "white", colour = "black"),
        legend.text = element_text( c("Vaccination", "Tests", "Cases", "Deaths")))

library(gridExtra)
g_legend<-function(a.gplot){
  tmp <- ggplot_gtable(ggplot_build(a.gplot))
  leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
  legend <- tmp$grobs[[leg]]
  return(legend)}

mylegend<-g_legend(plot2)

grid.arrange(arrangeGrob(plot1 + theme(legend.position="none"),
                         plot2 + theme(legend.position="none"),
                         nrow=1), mylegend, nrow=2, heights=c(2, 1))

```

<p>

The above graph shows how a decent vaccination rate in Peru has improved to drag down the number of positive coronavirus cases and casualties. Surprisingly, the vaccination rate dropped during august of 2021. However, the testing drives in the country have slowed a bit compared to 2020 where the people were not vaccinated. 
According to a [CVOID-19 tracker](https://graphics.reuters.com/world-coronavirus-tracker-and-maps/vaccination-rollout-and-access/), with the help of vaccinations, Covid-19 infections in Peru are decreasing. With more than 18M doses of Covid-19, approx 31.9% of the population has received one dose, and 25% of the countries’ population is fully vaccinated. 

</p>


<h2> References </h2>

- R libraries:

Hadley Wickham and Dana Seidel (2020). scales: Scale Functions for
  Visualization. R package version 1.1.1.
  https://CRAN.R-project.org/package=scales

Jeffrey A. Ryan and Joshua M. Ulrich (2020). quantmod: Quantitative
  Financial Modelling Framework. R package version 0.4.18.
  https://CRAN.R-project.org/package=quantmod
  
  C. Sievert. Interactive Web-Based Data Visualization with R, plotly,
  and shiny. Chapman and Hall/CRC Florida, 20

Garrett Grolemund, Hadley Wickham (2011). Dates and Times Made Easy
  with lubridate. Journal of Statistical Software, 40(3), 1-25. URL
  https://www.jstatsoft.org/v40/i03/.

H. Wickham. ggplot2: Elegant Graphics for Data Analysis.
  Springer-Verlag New York, 2016.


Hadley Wickham and Jim Hester (2021). readr: Read Rectangular Text
  Data. R package version 2.0.0.
  https://CRAN.R-project.org/package=readr

Hadley Wickham and Dana Seidel (2020). scales: Scale Functions for
  Visualization. R package version 1.1.1.
  https://CRAN.R-project.org/package=scales

JJ Allaire, Rich Iannone, Alison Presmanes Hill and Yihui Xie (2021).
  distill: 'R Markdown' Format for Scientific and Technical Writing. R
  package version 1.2. https://CRAN.R-project.org/package=distill

Kun Ren and Kenton Russell (2021). formattable: Create 'Formattable'
  Data Structures. R package version 0.2.1.
  https://CRAN.R-project.org/package=formattable

Ramnath Vaidyanathan, Kent Russell and Gareth Watts (2016).
  sparkline: 'jQuery' Sparkline 'htmlwidget'. R package version 2.0.
  https://CRAN.R-project.org/package=sparkline

Yihui Xie, Joe Cheng and Xianying Tan (2021). DT: A Wrapper of the
  JavaScript Library 'DataTables'. R package version 0.18.
  https://CRAN.R-project.org/package=DT
  
- Websites:

Reuters. 2021. COVID-19 vaccine rollout: charts, maps and eligibility by country. [online] Available at: <https://graphics.reuters.com/world-coronavirus-tracker-and-maps/vaccination-rollout-and-access/> [Accessed 3 September 2021].

Ritchie, H., Mathieu, E., Rodés-Guirao, L., Appel, C., Giattino, C., Ortiz-Ospina, E., Hasell, J., Macdonald, B., Beltekian, D. and Roser, M., 2021. Coronavirus Pandemic (COVID-19). [online] Our World in Data. Available at: <https://ourworldindata.org/coronavirus/country/peru> [Accessed 3 September 2021].

BBC News. 2021. Covid: Why has Peru been so badly hit?. [online] Available at: <https://www.bbc.com/news/world-latin-america-53150808> [Accessed 3 September 2021].